{"version":3,"sources":["../../server/controllers/CartController.js"],"names":["isCartOpen","req","res","next","user_id","prod_id","price","qty","body","result","context","models","cart","findOrCreate","where","cart_user_id","parseInt","cart_status","defaults","cart_created_on","Date","carts","dataValues","product","error","status","json","message","saveLineItem","line_items","lite_cart_id","cart_id","lite_prod_id","lite_price","parseFloat","lite_qty","lite_subtotal","lite_status","lite_order_name","update","returning","send","checkout","lineItems","forEach","el","cartId","updateCart","summaryCart","findAll","Prod","map","totalQty","reduce","total","subTotal","summary","updateLineItemOrder","orderName","updateCartOrder"],"mappings":"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","sourcesContent":["const isCartOpen = async (req, res, next) => {\r\n    const { user_id, prod_id, price, qty } = req.body;\r\n    try {\r\n        const result = await req.context.models.cart.findOrCreate({\r\n            where: { cart_user_id: parseInt(user_id), cart_status: 'OPEN' },\r\n            defaults: {\r\n                cart_created_on: new Date(),\r\n                cart_status: 'OPEN',\r\n                cart_user_id: user_id\r\n            }\r\n        });\r\n\r\n        req.carts = ({\r\n            cart: result[0].dataValues,\r\n            product: { prod_id, price, qty }\r\n        });\r\n\r\n        next();\r\n    } catch (error) {\r\n        res.status(404).json({ message: error.message })\r\n    }\r\n}\r\n\r\nconst saveLineItem = async (req, res) => {\r\n    const { cart, product } = req.carts;\r\n    // create product\r\n    try {\r\n        const result = await req.context.models.line_items.findOrCreate({\r\n            where: { lite_cart_id: cart.cart_id, lite_prod_id: product.prod_id },\r\n            defaults: {\r\n                lite_cart_id: parseInt(cart.cart_id),\r\n                lite_prod_id: parseInt(product.prod_id),\r\n                lite_price: parseFloat(product.price),\r\n                lite_qty: parseInt(product.qty),\r\n                lite_subtotal: parseInt(product.qty) * parseFloat(product.price),\r\n                lite_status: 'OPEN',\r\n                lite_order_name: null\r\n            }\r\n        });\r\n\r\n        //update product if data already exist\r\n        if (result[1] === false) {\r\n            try {\r\n                await req.context.models.line_items.update(\r\n                    {\r\n                        lite_price: parseFloat(product.price),\r\n                        lite_qty: parseInt(product.qty),\r\n                        lite_subtotal: parseInt(product.qty) * parseFloat(product.price)\r\n                    },\r\n                    { returning: true, where: { lite_cart_id: cart.cart_id, lite_prod_id: product.prod_id } }\r\n                );\r\n                res.send({ message: 'cart has been update' })\r\n            } catch (error) {\r\n                res.status(404).json({ message: error.message })\r\n            }\r\n        } else {\r\n            res.send({ message: 'cart has been add' })\r\n        }\r\n\r\n    } catch (error) {\r\n        res.status(404).json({ message: error.message })\r\n    }\r\n\r\n}\r\n\r\nconst checkout = async (req, res, next) => {\r\n    const lineItems = req.body;\r\n    try {\r\n        await lineItems.forEach(el => {\r\n            req.context.models.line_items.update(\r\n                {\r\n                    lite_price: parseFloat(el.price),\r\n                    lite_qty: parseInt(el.qty),\r\n                    lite_subtotal: parseInt(el.qty) * parseFloat(el.price),\r\n                    lite_status : 'CHECKOUT'\r\n                },\r\n                { returning: true, where: { lite_cart_id: el.cart_id, lite_prod_id: el.prod_id } }\r\n            );\r\n        });\r\n        req.cartId = lineItems[0].cart_id;\r\n        next();\r\n    } catch (error) {\r\n        res.status(404).json({ message: error.message })\r\n    }\r\n}\r\n\r\nconst updateCart = async (req, res) => {\r\n    const cart_id = req.cartId;\r\n    //update cart status\r\n    try {\r\n        await req.context.models.cart.update(\r\n            {\r\n                cart_status: 'CHECKOUT'\r\n            },\r\n            {returning : true, where : {cart_id : parseInt(cart_id)}} \r\n        );\r\n        res.send({message : 'data has been update'})\r\n    } catch (error) {\r\n        res.status(404).json({message : error.message})\r\n    }\r\n\r\n}\r\n\r\nconst summaryCart = async (req,res,next)=>{\r\n    const {cart_id} = req.body;\r\n\r\n    try {\r\n        const result = await req.context.models.line_items.findAll({\r\n            where : {lite_cart_id : cart_id, lite_status : 'CHECKOUT'}\r\n        });\r\n\r\n        const lineItems = result;\r\n        const Prod = lineItems.map(el => ({prod_id: el.lite_prod_id, qty : el.lite_qty}))\r\n        const totalQty = lineItems.reduce((total,el)=> total+el.lite_qty,0)\r\n        const subTotal = lineItems.reduce((total,el)=> total+ parseFloat(el.lite_subtotal),0)\r\n\r\n        req.Prod = Prod;\r\n        req.summaryCart=({\r\n            summary : {\r\n                totalQty : totalQty,\r\n                subTotal : subTotal,\r\n            }\r\n        });\r\n\r\n        next();\r\n\r\n    } catch (error) {\r\n        res.status(404).json({message : error.message})\r\n    }\r\n}\r\n\r\nconst updateLineItemOrder = async (req, res,next) => {\r\n    const {cart_id} = req.body\r\n    //update line_item status\r\n    try {\r\n        await req.context.models.line_items.update(\r\n            {\r\n                lite_status: 'ORDERED',\r\n                lite_order_name: req.orderName\r\n            },\r\n            {returning : true, where : {lite_cart_id : parseInt(cart_id)}} \r\n        );\r\n        next();\r\n    } catch (error) {\r\n        res.status(404).json({message : error.message})\r\n    }\r\n\r\n}\r\n\r\nconst updateCartOrder = async (req, res) => {\r\n    const {cart_id} = req.body\r\n    //update cart status\r\n    try {\r\n        await req.context.models.cart.update(\r\n            {\r\n                cart_status: 'CLOSED'\r\n            },\r\n            {returning : true, where : {cart_id : parseInt(cart_id)}} \r\n        );\r\n        res.send({message : 'data has been update'})\r\n    } catch (error) {\r\n        res.status(404).json({message : error.message})\r\n    }\r\n\r\n}\r\n\r\nexport default {\r\n    isCartOpen,\r\n    saveLineItem,\r\n    checkout,\r\n    updateCart,\r\n    summaryCart,\r\n    updateLineItemOrder,\r\n    updateCartOrder\r\n}"],"file":"CartController.js"}