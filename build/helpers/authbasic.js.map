{"version":3,"sources":["../../server/helpers/authbasic.js"],"names":["passport","require","Strategy","expressSession","sessionSecret","process","env","SESSION_SECRET","adminPassword","ADMIN_PASSWORD","use","adminStrategy","serializeUser","user","cb","deserializeUser","authenticate","module","exports","setMiddleware","login","ensureAdmin","app","session","initialize","req","res","next","json","success","isAdmin","username","err","Error","statusCode","password","secret","resave","saveUninitialized"],"mappings":";;AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMC,QAAQ,GAAGD,OAAO,CAAC,gBAAD,CAAP,CAA0BC,QAA3C;;AACA,MAAMC,cAAc,GAAGF,OAAO,CAAC,iBAAD,CAA9B;;AAEA,MAAMG,aAAa,GAAGC,OAAO,CAACC,GAAR,CAAYC,cAAZ,IAA8B,OAApD;AACA,MAAMC,aAAa,GAAGH,OAAO,CAACC,GAAR,CAAYG,cAAZ,IAA8B,QAApD;AAGAT,QAAQ,CAACU,GAAT,CAAaC,aAAa,EAA1B;AAEAX,QAAQ,CAACY,aAAT,CAAuB,CAACC,IAAD,EAAOC,EAAP,KAAcA,EAAE,CAAC,IAAD,EAAOD,IAAP,CAAvC;AACAb,QAAQ,CAACe,eAAT,CAAyB,CAACF,IAAD,EAAOC,EAAP,KAAcA,EAAE,CAAC,IAAD,EAAOD,IAAP,CAAzC;AAEA,MAAMG,YAAY,GAAGhB,QAAQ,CAACgB,YAAT,CAAsB,OAAtB,CAArB;AAGCC,MAAM,CAACC,OAAP,GAAiB;AACdC,EAAAA,aADc;AAEdH,EAAAA,YAFc;AAGdI,EAAAA,KAHc;AAIdC,EAAAA;AAJc,CAAjB;;AASD,SAASF,aAAT,CAAuBG,GAAvB,EAA4B;AACxBA,EAAAA,GAAG,CAACZ,GAAJ,CAAQa,OAAO,EAAf;AACAD,EAAAA,GAAG,CAACZ,GAAJ,CAAQV,QAAQ,CAACwB,UAAT,EAAR;AACAF,EAAAA,GAAG,CAACZ,GAAJ,CAAQV,QAAQ,CAACuB,OAAT,EAAR;AACH;;AACD,SAASH,KAAT,CAAeK,GAAf,EAAoBC,GAApB,EAAyBC,IAAzB,EAA+B;AAC3BD,EAAAA,GAAG,CAACE,IAAJ,CAAS;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAT;AACH;;AAED,SAASR,WAAT,CAAqBI,GAArB,EAA0BC,GAA1B,EAA+BC,IAA/B,EAAqC;AACjC,QAAMG,OAAO,GAAGL,GAAG,CAACZ,IAAJ,IAAYY,GAAG,CAACZ,IAAJ,CAASkB,QAAT,KAAsB,OAAlD;AACA,MAAID,OAAJ,EAAa,OAAOH,IAAI,EAAX;AACb,QAAMK,GAAG,GAAG,IAAIC,KAAJ,CAAU,cAAV,CAAZ;AACAD,EAAAA,GAAG,CAACE,UAAJ,GAAiB,GAAjB;AACAP,EAAAA,IAAI,CAACK,GAAD,CAAJ;AACH;;AAED,SAASrB,aAAT,GAAyB;AACrB,SAAO,IAAIT,QAAJ,CAAa,UAAU6B,QAAV,EAAoBI,QAApB,EAA8BrB,EAA9B,EAAkC;AAClD,UAAMgB,OAAO,GAAGC,QAAQ,KAAK,OAAb,IAAwBI,QAAQ,KAAK3B,aAArD;AACA,QAAIsB,OAAJ,EAAa,OAAOhB,EAAE,CAAC,IAAD,EAAO;AAAEiB,MAAAA,QAAQ,EAAE;AAAZ,KAAP,CAAT;AACbjB,IAAAA,EAAE,CAAC,IAAD,EAAO,KAAP,CAAF;AACH,GAJM,CAAP;AAKH;;AACD,SAASS,OAAT,GAAmB;AACf,SAAOpB,cAAc,CAAC;AAClBiC,IAAAA,MAAM,EAAEhC,aADU;AAElBiC,IAAAA,MAAM,EAAE,KAFU;AAGlBC,IAAAA,iBAAiB,EAAE;AAHD,GAAD,CAArB;AAKH","sourcesContent":["const passport = require('passport')\r\nconst Strategy = require('passport-local').Strategy\r\nconst expressSession = require('express-session')\r\n\r\nconst sessionSecret = process.env.SESSION_SECRET || 'admin'\r\nconst adminPassword = process.env.ADMIN_PASSWORD || 'secret'\r\n\r\n\r\npassport.use(adminStrategy())\r\n\r\npassport.serializeUser((user, cb) => cb(null, user))\r\npassport.deserializeUser((user, cb) => cb(null, user))\r\n\r\nconst authenticate = passport.authenticate('local')\r\n\r\n\r\n module.exports = {\r\n    setMiddleware,\r\n    authenticate,\r\n    login,\r\n    ensureAdmin\r\n} \r\n\r\n\r\n\r\nfunction setMiddleware(app) {\r\n    app.use(session())\r\n    app.use(passport.initialize())\r\n    app.use(passport.session())\r\n}\r\nfunction login(req, res, next) {\r\n    res.json({ success: true })\r\n}\r\n\r\nfunction ensureAdmin(req, res, next) {\r\n    const isAdmin = req.user && req.user.username === 'admin'\r\n    if (isAdmin) return next()\r\n    const err = new Error('Unauthorized')\r\n    err.statusCode = 401\r\n    next(err)\r\n}\r\n\r\nfunction adminStrategy() {\r\n    return new Strategy(function (username, password, cb) {\r\n        const isAdmin = username === 'admin' && password === adminPassword\r\n        if (isAdmin) return cb(null, { username: 'admin' })\r\n        cb(null, false)\r\n    })\r\n}\r\nfunction session() {\r\n    return expressSession({\r\n        secret: sessionSecret,\r\n        resave: false,\r\n        saveUninitialized: false\r\n    })\r\n} \r\n"],"file":"authbasic.js"}